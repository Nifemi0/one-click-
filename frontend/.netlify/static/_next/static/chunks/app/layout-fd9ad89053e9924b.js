(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{347:()=>{},1148:(e,t,o)=>{"use strict";o.d(t,{WalletProvider:()=>c,v:()=>r});var n=o(5155),l=o(2115);let a=(0,l.createContext)(void 0);function r(){let e=(0,l.useContext)(a);if(void 0===e)throw Error("useWallet must be used within a WalletProvider");return e}function c(e){let{children:t}=e,[o,r]=(0,l.useState)(!1),[c,s]=(0,l.useState)(null),[i,d]=(0,l.useState)(null),[u,h]=(0,l.useState)(null),[w,g]=(0,l.useState)(!1),[m,f]=(0,l.useState)(null);(0,l.useEffect)(()=>{let e=localStorage.getItem("oneclick_jwt_token"),t=localStorage.getItem("oneclick_wallet_address");e&&t&&(console.log("\uD83D\uDD04 Restoring wallet connection from localStorage..."),h(e),s(t),r(!0),g(!0),(async()=>{try{let e=v();if(e){let o=await e.request({method:"eth_accounts"});o.length>0&&o[0].toLowerCase()===t.toLowerCase()?(console.log("✅ Wallet still connected, restoring full state"),s(o[0]),r(!0),g(!0),e.on&&(e.on("accountsChanged",async e=>{if(console.log("\uD83D\uDD04 Account changed:",e),0===e.length)_();else{let t=e[0];s(t);let o=await k(t);o?(h(o),g(!0)):(g(!1),h(null))}}),e.on("chainChanged",e=>{console.log("\uD83D\uDD04 Chain changed:",e),d(parseInt(e,16))}))):(console.log("⚠️ Saved account no longer connected, clearing state"),_())}else console.log("⚠️ No wallet provider available, clearing state"),_()}catch(e){console.error("❌ Error reconnecting wallet:",e),_()}})());let n=async()=>{if(o&&c){console.log("\uD83D\uDD04 Window focused, checking wallet status...");try{let e=v();if(e){let t=await e.request({method:"eth_accounts"});(0===t.length||t[0].toLowerCase()!==c.toLowerCase())&&(console.log("⚠️ Wallet disconnected, updating state"),_())}}catch(e){console.error("❌ Error checking wallet status on focus:",e)}}};return window.addEventListener("focus",n),()=>{window.removeEventListener("focus",n)}},[o,c]);let v=()=>{try{var e,t;if(null==(e=window.ethereum)?void 0:e.isMetaMask)return console.log("✅ Found MetaMask provider"),window.ethereum;if(window.ethereum)return console.log("✅ Found generic ethereum provider"),window.ethereum;let o=[window.binanceChain,window.coinbaseWalletExtension,null==(t=window.phantom)?void 0:t.ethereum,window.trustwallet].filter(Boolean);if(o.length>0)return console.log("✅ Found alternative wallet provider:",o[0]),o[0];return console.log("❌ No wallet providers found"),null}catch(e){return console.error("Error detecting wallet providers:",e),null}},k=async e=>{try{let t,o=v();if(!o)throw Error("No wallet provider available");let n="Connect to One Click Security\n\nWallet: ".concat(e,"\nTimestamp: ").concat(Date.now(),'\n\nClick "Sign" to authenticate with the backend.');try{t=await o.request({method:"personal_sign",params:[n,e]})}catch(e){if(4001===e.code)throw Error("User rejected the signature request");throw e}let l=await fetch("https://one-click-c308.onrender.com/api/auth/connect",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({walletAddress:e,signature:t,message:n})});if(l.ok){let t=await l.json();if(t.success&&t.token)return localStorage.setItem("oneclick_jwt_token",t.token),localStorage.setItem("oneclick_wallet_address",e),t.token}throw Error("Authentication failed")}catch(e){return console.error("Backend authentication error:",e),null}},p=async()=>{try{let e;f(null),console.log("\uD83D\uDD0D Attempting to connect wallet...");let t=v();if(!t){console.log("❌ No wallet provider found"),f("No wallet provider found. Please install MetaMask or another compatible wallet.");return}console.log("✅ Wallet provider found, requesting accounts...");try{e=await t.request({method:"eth_requestAccounts"}),console.log("✅ Accounts received:",e)}catch(e){if(console.error("❌ Account request failed:",e),4001===e.code)return void f("User rejected the connection request");throw e}if(e.length>0){let o=e[0];console.log("✅ Setting wallet address:",o),s(o),r(!0);try{let e=await t.request({method:"eth_chainId"});console.log("✅ Chain ID received:",e),d(parseInt(e,16))}catch(e){console.warn("⚠️ Failed to get chain ID:",e)}console.log("\uD83D\uDD10 Authenticating with backend...");let n=await k(o);n?(h(n),g(!0),console.log("✅ Successfully authenticated with backend")):(console.error("❌ Failed to authenticate with backend"),f("Failed to authenticate with backend. Please try again.")),t.on&&(t.on("accountsChanged",async e=>{if(console.log("\uD83D\uDD04 Account changed:",e),0===e.length)_();else{let t=e[0];s(t);let o=await k(t);o?(h(o),g(!0)):(g(!1),h(null))}}),t.on("chainChanged",e=>{console.log("\uD83D\uDD04 Chain changed:",e),d(parseInt(e,16))}))}else console.log("❌ No accounts received"),f("No accounts found. Please unlock your wallet and try again.")}catch(e){console.error("❌ Error connecting wallet:",e),f(e.message||"Failed to connect wallet. Please try again.")}},_=()=>{console.log("\uD83D\uDD0C Disconnecting wallet..."),r(!1),g(!1),s(null),d(null),h(null),f(null),localStorage.removeItem("oneclick_jwt_token"),localStorage.removeItem("oneclick_wallet_address")};return(0,n.jsx)(a.Provider,{value:{isConnected:o,address:c,chainId:i,token:u,connect:p,disconnect:_,manualDisconnect:()=>{console.log("\uD83D\uDD0C Manual wallet disconnect..."),r(!1),g(!1),s(null),d(null),h(null),f(null),localStorage.removeItem("oneclick_jwt_token"),localStorage.removeItem("oneclick_wallet_address")},isAuthenticated:w,walletError:m},children:t})}},2260:(e,t,o)=>{"use strict";o.d(t,{D:()=>c,ThemeProvider:()=>r});var n=o(5155),l=o(2115);let a=(0,l.createContext)(void 0);function r(e){let{children:t}=e,[o,r]=(0,l.useState)("system"),[c,s]=(0,l.useState)("dark");return(0,l.useEffect)(()=>{let e=localStorage.getItem("theme");e&&r(e)},[]),(0,l.useEffect)(()=>{let e=window.document.documentElement;if(e.classList.remove("light","dark"),"system"===o){let t=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";s(t),e.classList.add(t)}else s(o),e.classList.add(o);localStorage.setItem("theme",o)},[o]),(0,l.useEffect)(()=>{let e=window.matchMedia("(prefers-color-scheme: dark)"),t=()=>{if("system"===o){let t=e.matches?"dark":"light";s(t),window.document.documentElement.classList.remove("light","dark"),window.document.documentElement.classList.add(t)}};return e.addEventListener("change",t),()=>e.removeEventListener("change",t)},[o]),(0,n.jsx)(a.Provider,{value:{theme:o,setTheme:r,resolvedTheme:c},children:t})}function c(){let e=(0,l.useContext)(a);if(void 0===e)throw Error("useTheme must be used within a ThemeProvider");return e}},5356:e=>{e.exports={style:{fontFamily:"'Inter', 'Inter Fallback'",fontStyle:"normal"},className:"__className_e8ce0c"}},8533:(e,t,o)=>{Promise.resolve().then(o.t.bind(o,5356,23)),Promise.resolve().then(o.t.bind(o,347,23)),Promise.resolve().then(o.bind(o,2260)),Promise.resolve().then(o.bind(o,1148))}},e=>{e.O(0,[444,441,964,358],()=>e(e.s=8533)),_N_E=e.O()}]);